<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Api test</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {


            /*function to sanitize the JSON if it is necesary*/
            function sanitizeJSON(unsanitized) {
                var str = JSON.stringify(unsanitized);
                var output = str.replace(/\\/g, "\\\\").replace(/\n/g, "\\n").replace(/\r/g, "\\r").replace(/\t/g, "\\t").replace(/\f/g, "\\f").replace(/"/g, "\\\"").replace(/'/g, "\\\'").replace(/\&/g, "\\&");
                return output;
            }


            /*
            JSONP, which stands for "JSON with Padding" (and JSON stands for JavaScript Object Notation), is a way to get data from another domain that bypasses CORS (Cross Origin Resource Sharing) rules. CORS is a set of "rules," about transferring data between sites that have a different domain name from the client.
            We would like to see if we can get an valid JSON result which we can parse in using AJAX
            */

            /* Update all the parameters for your API test*/
            var params = {
                tagged: 'html',
                site: 'stackoverflow',
                order: 'desc',
                sort: 'creation'
            };

            var result = $.ajax({
                /* update API end point */
                url: "http://api.stackexchange.com/2.2/questions/unanswered",
                data: params,
                dataType: "jsonp",
                /*set the call type GET / POST*/
                type: "GET",
            })

            /* if the call is successful (status 200 OK) show results */
            .done(function (result) {
                /* if the results are meeningful, we can just console.log them */
                console.log(result);

                /* if the results are not meeningful, it might help to convert them to string first */
                var displayStringifiedResults = JSON.stringify(result);
                console.log(displayStringifiedResults);

                /* if the results contain ivalid json, it might help to sanitize them first */
                var displaySanitizedResults = sanitizeJSON(result);
                console.log(displaySanitizedResults);

            })

            /* if the call is NOT successful show errors */
            .fail(function (jqXHR, error, errorThrown) {
                console.log(jqXHR);
                console.log(error);
                console.log(errorThrown);
            });


            /*
                    *******************
                    food2fork.com example (NOT WORKING)
                    *******************

                    var request = {key: '05e604a8ad49609e35434f801b205d87',
                        q: 'chicken'};

                    var result = $.ajax({
                        url: "http://food2fork.com/api/search",
                        data: request,
                        dataType: "jsonp",
                        type: "GET",
                        })
                    .done(function(result){
                        var displayResults = "Data from Server : " + JSON.stringify(result);
                        console.log(displayResults);
                    })
                    .fail(function(jqXHR, error, errorThrown){
                        console.log(jqXHR);
                        console.log(error);
                        console.log(errorThrown);
                    });
                    */



            /*
            *******************
            example of Access-Control-Request-Headers for JSON (NOT WORKING)
            *******************
            $.ajax({
                    url: "http://food2fork.com/api/search?key=05e604a8ad49609e35434f801b205d87&q=chicken",
                    dataType: 'json',
                    crossDomain: true,
                    crossOrigin: true,
                    type: "GET",
                    async:false,
                    beforeSend: function(xhr){xhr.setRequestHeader('Access-Control-Request-Headers', 'x-requested-with');},
                    success: function(results){
                        console.log(results);
                    }
                });
            */





            /*
            *******************
            example of CORSRequest (NOT WORKING)
            *******************

                // Create the XHR object.
                function createCORSRequest(method, url) {
                  var xhr = new XMLHttpRequest();
                  if ("withCredentials" in xhr) {
                    // XHR for Chrome/Firefox/Opera/Safari.
                    xhr.open(method, url, true);
                  } else if (typeof XDomainRequest != "undefined") {
                    // XDomainRequest for IE.
                    xhr = new XDomainRequest();
                    xhr.open(method, url);
                  } else {
                    // CORS not supported.
                    xhr = null;
                  }
                  return xhr;
                }

                // Helper method to parse the title tag from the response.
                function getTitle(text) {
                  return text.match('<title>(.*)?</title>')[1];
                }

                // Make the actual CORS request.
                function makeCorsRequest() {
                  // All HTML5 Rocks properties support CORS.
                  var url = 'http://food2fork.com/api/search?key=05e604a8ad49609e35434f801b205d87&q=chicken';

                  var xhr = createCORSRequest('GET', url);
                  if (!xhr) {
                    alert('CORS not supported');
                    return;
                  }
                 else {
                     alert('asasa');
                    }

                  // Response handlers.
                  xhr.onload = function() {
                    var text = xhr.responseText;
                    var title = getTitle(text);
                    alert('Response from CORS request to ' + url + ': ' + title);
                  };

                  xhr.onerror = function() {
                    alert('Woops, there was an error making the request.');
                  };

                  xhr.send();
                }
                makeCorsRequest();
            */


        });
    </script>

</head>

<body>
    <p>There is nothing to see here. Please check your console log instead</p>
</body>

</html>
